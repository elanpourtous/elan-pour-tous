/* include.min.js — Élan pour tous */
(function(){if(window.__EPT_INIT__)return;window.__EPT_INIT__=true;const d=document,html=d.documentElement,body=d.body,$=(s,c=d)=>c.querySelector(s),$$=(s,c=d)=>Array.from(c.querySelectorAll(s));
/* MENU */
(function(){const m=$('#menu-toggle'),n=$('#primary-nav');if(!m||!n)return;m.type='button';m.setAttribute('aria-expanded','false');m.setAttribute('aria-controls','primary-nav');if(!n.hasAttribute('hidden'))n.setAttribute('hidden','');m.addEventListener('click',()=>{const e=m.getAttribute('aria-expanded')==='true';m.setAttribute('aria-expanded',String(!e));m.setAttribute('aria-label',e?'Ouvrir le menu':'Fermer le menu');n.toggleAttribute('hidden');if(!e)n.querySelector('a')?.focus();});d.addEventListener('keydown',e=>{if(e.key==='Escape'&&m.getAttribute('aria-expanded')==='true'){m.click();m.focus();}});})();
/* ARIA-CURRENT */
(function(){try{const p=location.pathname.split('/').pop()||'index.html';$$('#primary-nav a').forEach(a=>{const h=a.getAttribute('href')||'';h.endsWith(p)?a.setAttribute('aria-current','page'):a.removeAttribute('aria-current');});}catch{} })();
/* A11Y ACTIONS */
(function(){const LS='accessPrefs';if(!getComputedStyle(html).getPropertyValue('--font-scale'))html.style.setProperty('--font-scale','1');try{const s=JSON.parse(localStorage.getItem(LS)||'{}');if(s.fontScale)html.style.setProperty('--font-scale',s.fontScale);if(s.contrast)body.classList.add('high-contrast');if(s.spacing)body.classList.add('wide-spacing');}catch{}const clamp=(v,min,max)=>Math.min(max,Math.max(min,v));function save(){try{localStorage.setItem(LS,JSON.stringify({fontScale:html.style.getPropertyValue('--font-scale'),contrast:body.classList.contains('high-contrast'),spacing:body.classList.contains('wide-spacing')}))}catch{}}
const A={'font+':()=>{let v=parseFloat(getComputedStyle(html).getPropertyValue('--font-scale'))||1;v=clamp(+(v+0.1).toFixed(2),0.8,1.8);html.style.setProperty('--font-scale',String(v));save();},'font-':()=>{let v=parseFloat(getComputedStyle(html).getPropertyValue('--font-scale'))||1;v=clamp(+(v-0.1).toFixed(2),0.8,1.8);html.style.setProperty('--font-scale',String(v));save();},contrast:()=>{body.classList.toggle('high-contrast');save();},spacing:()=>{body.classList.toggle('wide-spacing');save();},reset:()=>{html.style.setProperty('--font-scale','1');body.classList.remove('high-contrast','wide-spacing');localStorage.removeItem(LS);}};
(function bind(){function bindBtns(ctx=d){ctx.querySelectorAll('.access-btn[data-action]').forEach(b=>{if(b.__bound)return;b.type=b.type||'button';const a=b.getAttribute('data-action');b.addEventListener('click',e=>{e.preventDefault();A[a]&&A[a]();});b.__bound=true;});}
bindBtns();const mo=new MutationObserver(muts=>{for(const m of muts){if(m.type==='childList'){m.addedNodes&&m.addedNodes.forEach&&m.addedNodes.forEach(n=>{if(n.nodeType===1)bindBtns(n);});}}});mo.observe(d.documentElement,{childList:true,subtree:true});})();
d.addEventListener('keydown',e=>{if(!e.altKey)return;const k=(e.key||'').toLowerCase(),c=e.code||'';if(k==='-'||c==='Minus'||c==='NumpadSubtract'){e.preventDefault();A['font-']();return}if(k==='='||k==='+'||c==='Equal'||c==='NumpadAdd'){e.preventDefault();A['font+']();return}if(k==='c'){e.preventDefault();A['contrast']();return}if(k==='s'){e.preventDefault();A['spacing']();return}if(k==='0'||c==='Digit0'||c==='Numpad0'){e.preventDefault();A['reset']();return}});})();
/* THEME */
(function(){const t=$('#theme-toggle'),mt=$('meta[name="theme-color"]');const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;const saved=localStorage.getItem('theme');const initial=saved||(prefersDark?'dark':'light');apply(initial,false);t?.addEventListener('click',()=>{const nx=html.getAttribute('data-theme')==='dark'?'light':'dark';apply(nx,true);});if(!saved&&window.matchMedia){window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',e=>apply(e.matches?'dark':'light',false));}
function apply(mode,persist){html.setAttribute('data-theme',mode);const dark=mode==='dark';if(t){t.setAttribute('aria-pressed',String(dark));t.setAttribute('aria-label',dark?'Désactiver le mode sombre':'Activer le mode sombre');t.setAttribute('title',dark?'Désactiver le mode sombre':'Activer le mode sombre');}if(mt)mt.setAttribute('content',dark?'#0a6a47':'#0b8457');if(persist)localStorage.setItem('theme',mode);} })();
/* TTS TOGGLE */
(function(){const g=$('#tts-toggle'),bar=$('.tts-bar');if(!g||!bar)return;bar.removeAttribute('hidden');const sv=localStorage.getItem('ttsVisible');const show=sv?(sv==='shown'):true;function on(){bar.classList.add('is-visible');bar.removeAttribute('aria-hidden');g.setAttribute('aria-pressed','true');localStorage.setItem('ttsVisible','shown');}
function off(){bar.classList.remove('is-visible');bar.setAttribute('aria-hidden','true');g.setAttribute('aria-pressed','false');localStorage.setItem('ttsVisible','hidden');}
show?on():off();g.addEventListener('click',()=>{bar.classList.contains('is-visible')?off():on();});})();
})();
