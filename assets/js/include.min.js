// Accessibilité visuelle (taille, contraste, espacement, reset)
(function(){
  const root = document.documentElement, body = document.body;

  // Init défaut
  if (!getComputedStyle(root).getPropertyValue('--font-scale')) {
    root.style.setProperty('--font-scale','1');
  }

  // Récup prefs
  const saved = JSON.parse(localStorage.getItem('accessPrefs') || '{}');
  if (saved.fontScale) root.style.setProperty('--font-scale', saved.fontScale);
  if (saved.contrast)  body.classList.add('high-contrast');
  if (saved.spacing)   body.classList.add('wide-spacing');

  function save() {
    localStorage.setItem('accessPrefs', JSON.stringify({
      fontScale: root.style.getPropertyValue('--font-scale'),
      contrast:  body.classList.contains('high-contrast'),
      spacing:   body.classList.contains('wide-spacing')
    }));
  }

  const actions = {
    'font+': () => {
      let v = parseFloat(getComputedStyle(root).getPropertyValue('--font-scale')) || 1;
      if (v < 1.6) { v = +(v + 0.1).toFixed(2); root.style.setProperty('--font-scale', String(v)); save(); }
    },
    'font-': () => {
      let v = parseFloat(getComputedStyle(root).getPropertyValue('--font-scale')) || 1;
      if (v > 0.8) { v = +(v - 0.1).toFixed(2); root.style.setProperty('--font-scale', String(v)); save(); }
    },
    'contrast': () => { body.classList.toggle('high-contrast'); save(); },
    'spacing':  () => { body.classList.toggle('wide-spacing');  save(); },
    'reset':    () => {
      root.style.setProperty('--font-scale','1');
      body.classList.remove('high-contrast','wide-spacing');
      localStorage.removeItem('accessPrefs');
    }
  };

  document.querySelectorAll('.access-btn[data-action]').forEach(btn => {
    btn.addEventListener('click', () => actions[btn.getAttribute('data-action')]?.());
  });

  // Raccourcis : Alt + -, Alt + =, Alt + C, Alt + S, Alt + 0
  document.addEventListener('keydown', (e) => {
    if (!e.altKey) return;
    const k = e.key.toLowerCase();
    if (k === '-') { e.preventDefault(); actions['font-'](); }
    if (k === '=') { e.preventDefault(); actions['font+'](); }
    if (k === 'c') { e.preventDefault(); actions['contrast'](); }
    if (k === 's') { e.preventDefault(); actions['spacing'](); }
    if (k === '0') { e.preventDefault(); actions['reset'](); }
  });
})();
