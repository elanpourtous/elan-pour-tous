(function(){if(window._ttsInit)return;window._ttsInit=true;const h='speechSynthesis'in window&&'SpeechSynthesisUtterance'in window,p=document.getElementById('tts-play'),a=document.getElementById('tts-pause'),r=document.getElementById('tts-resume'),s=document.getElementById('tts-stop'),e=document.getElementById('tts-rate'),v=document.getElementById('tts-rate-val'),o=document.getElementById('tts-voice'),l=document.getElementById('tts-live'),b=document.querySelector('.tts-bar');function S(t){if(!a||!r||!s||!p)return;a.disabled=!t;r.disabled=!t;s.disabled=!t;p.disabled=t}function T(){const m=document.getElementById('contenu')||document.body,c=m.cloneNode(true);c.querySelectorAll('.tts-bar, script, style').forEach(n=>n.remove());return c.innerText.replace(/\s+/g,' ').trim()}function V(){if(!o)return;const i=speechSynthesis.getVoices();o.innerHTML='';i.filter(x=>x.lang.toLowerCase().startsWith('fr')).concat(i).filter((x,j,A)=>A.indexOf(x)===j).forEach(x=>{const d=document.createElement('option');d.value=x.name;d.textContent=`${x.name} (${x.lang})`;o.appendChild(d)})}function P(t){window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t||'Aucun contenu à lire.');u.lang='fr-FR';u.rate=parseFloat(e?.value||'1');const c=Array.from(speechSynthesis.getVoices()).find(x=>x.name===o?.value);if(c)u.voice=c;u.onend=()=>{S(false);l&&(l.textContent='Lecture terminée.')};u.onerror=()=>{S(false);l&&(l.textContent='Erreur de lecture.')};window.speechSynthesis.speak(u);l&&(l.textContent='Lecture en cours…');S(true)}if(!h){b&&b.insertAdjacentHTML('beforeend','<span class="hint">La lecture vocale n’est pas disponible sur ce navigateur.</span>');[p,a,r,s,e,o].forEach(x=>x&&(x.disabled=true));return}V();speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=V);p?.addEventListener('click',()=>P(T()));a?.addEventListener('click',()=>{speechSynthesis.pause();l&&(l.textContent='Pause.')});r?.addEventListener('click',()=>{speechSynthesis.resume();l&&(l.textContent='Reprise.')});s?.addEventListener('click',()=>{speechSynthesis.cancel();S(false);l&&(l.textContent='Lecture stoppée.')});e?.addEventListener('input',()=>{v&&(v.textContent=`${parseFloat(e.value).toFixed(1)}×`)});document.addEventListener('keydown',t=>{if(!t.altKey)return;const k=t.key.toLowerCase();if(k==='l'){t.preventDefault();P(T())}k==='p'&&(t.preventDefault(),speechSynthesis.pause());k==='r'&&(t.preventDefault(),speechSynthesis.resume());k==='s'&&(t.preventDefault(),speechSynthesis.cancel(),S(false))})})();
